<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Murry Fuel - Chicken Sandwich Chase!</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            touch-action: none;
        }
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-user-select: none;
            user-select: none;
        }
        #gameContainer {
            text-align: center;
            position: relative;
            width: 100%;
            max-width: 850px;
            padding: 5px;
        }
        h1 {
            color: #ff6b35;
            font-size: clamp(1.2em, 5vw, 2.2em);
            margin-bottom: 3px;
            text-shadow: 2px 2px 0px #ffc300;
        }
        .subtitle {
            color: #ffc300;
            font-size: clamp(0.7em, 2.5vw, 0.9em);
            margin-bottom: 5px;
        }
        #hud {
            display: flex;
            justify-content: space-around;
            padding: 6px 10px;
            background: rgba(0,0,0,0.5);
            border-radius: 8px;
            margin-bottom: 5px;
            flex-wrap: wrap;
            gap: 5px;
        }
        .hud-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .hud-label {
            color: #aaa;
            font-size: clamp(0.6em, 2vw, 0.8em);
        }
        .hud-value {
            color: #ffc300;
            font-size: clamp(0.8em, 2.5vw, 1em);
            font-weight: bold;
        }
        .meter-container {
            width: clamp(60px, 15vw, 100px);
            height: 14px;
            background: #333;
            border-radius: 7px;
            overflow: hidden;
            border: 2px solid #555;
        }
        #hungerMeter {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ff8844);
            width: 100%;
            transition: width 0.3s;
        }
        #bellyMeter {
            height: 100%;
            background: linear-gradient(90deg, #44aa44, #ffcc00, #ff0000);
            width: 0%;
            transition: width 0.3s;
        }
        #canvasWrapper {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }
        canvas {
            border: 3px solid #ff6b35;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
            display: block;
            width: 100%;
            height: auto;
            touch-action: none;
        }
        #instructions {
            color: #aaa;
            margin-top: 5px;
            font-size: clamp(0.6em, 2vw, 0.85em);
            padding: 0 10px;
        }
        #overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.92);
            padding: clamp(15px, 4vw, 35px);
            border-radius: 15px;
            border: 3px solid #ff6b35;
            z-index: 100;
            width: 90%;
            max-width: 400px;
        }
        #overlay h2 {
            color: #ff6b35;
            font-size: clamp(1.3em, 5vw, 1.8em);
            margin-bottom: 10px;
        }
        #overlay p {
            color: #ffc300;
            font-size: clamp(0.85em, 3vw, 1em);
            margin-bottom: 8px;
        }
        #overlay .info {
            color: #aaa;
            font-size: clamp(0.75em, 2.5vw, 0.9em);
            margin: 10px 0;
        }
        #overlay button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: clamp(10px, 3vw, 15px) clamp(25px, 8vw, 40px);
            font-size: clamp(1em, 3.5vw, 1.2em);
            border-radius: 10px;
            cursor: pointer;
            margin-top: 8px;
            -webkit-tap-highlight-color: transparent;
        }
        #overlay button:hover, #overlay button:active {
            background: #ff8855;
        }
        .hidden { display: none !important; }

        /* Mobile Controls */
        #mobileControls {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px;
            z-index: 50;
        }
        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 500px;
            margin: 0 auto;
        }
        .dpad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3px;
            width: 130px;
        }
        .dpad-btn {
            width: 42px;
            height: 42px;
            background: rgba(255, 107, 53, 0.7);
            border: 2px solid #ff6b35;
            border-radius: 8px;
            color: white;
            font-size: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        .dpad-btn:active, .dpad-btn.active {
            background: #ff6b35;
            transform: scale(0.95);
        }
        .dpad-btn.empty {
            visibility: hidden;
        }
        #jumpBtn {
            width: 90px;
            height: 90px;
            background: rgba(255, 199, 0, 0.7);
            border: 3px solid #ffc300;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        #jumpBtn:active, #jumpBtn.active {
            background: #ffc300;
            transform: scale(0.95);
        }

        /* Show mobile controls on touch devices */
        @media (hover: none) and (pointer: coarse) {
            #mobileControls { display: block; }
            #instructions { display: none; }
            #gameContainer { padding-bottom: 130px; }
        }

        /* Landscape phone adjustments */
        @media (max-height: 500px) and (orientation: landscape) {
            h1 { font-size: 1.2em; margin-bottom: 2px; }
            .subtitle { display: none; }
            #hud { padding: 4px 8px; gap: 3px; }
            .meter-container { width: 50px; height: 12px; }
            #mobileControls { padding: 5px; }
            .dpad-btn { width: 36px; height: 36px; font-size: 16px; }
            #jumpBtn { width: 70px; height: 70px; font-size: 12px; }
            #gameContainer { padding-bottom: 100px; }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <h1>üçó MURRY FUEL üçó</h1>
        <div class="subtitle">The Chicken Sandwich Chase!</div>
        <div id="hud">
            <div class="hud-item">
                <span class="hud-label">üçó</span>
                <span class="hud-value" id="scoreDisplay">0</span>
            </div>
            <div class="hud-item">
                <span class="hud-label">üòã</span>
                <div class="meter-container"><div id="hungerMeter"></div></div>
            </div>
            <div class="hud-item">
                <span class="hud-label">ü§∞</span>
                <div class="meter-container"><div id="bellyMeter"></div></div>
            </div>
            <div class="hud-item">
                <span class="hud-label">üöΩ</span>
                <span class="hud-value" id="poopDisplay">0/2</span>
            </div>
            <div class="hud-item">
                <span class="hud-label">‚≠ê</span>
                <span class="hud-value" id="levelDisplay">1</span>
            </div>
        </div>
        <div id="canvasWrapper">
            <canvas id="game" width="800" height="500"></canvas>
        </div>
        <div id="instructions">‚¨ÖÔ∏è‚û°Ô∏è Arrow Keys | SPACE Jump | Eat üçó ‚Üí Get full ‚Üí üöΩ ‚Üí Repeat!</div>

        <div id="overlay">
            <h2 id="overlayTitle">üçó MURRY FUEL üçó</h2>
            <p id="overlayText">Help Murry chase chicken sandwiches!</p>
            <div class="info" id="overlayInfo">Eat sandwiches ‚Üí Get full ‚Üí Find toilet ‚Üí Repeat!</div>
            <button id="overlayBtn">START GAME</button>
        </div>
    </div>

    <!-- Mobile Controls -->
    <div id="mobileControls">
        <div class="control-row">
            <div class="dpad">
                <div class="dpad-btn empty"></div>
                <div class="dpad-btn" id="upBtn">‚¨ÜÔ∏è</div>
                <div class="dpad-btn empty"></div>
                <div class="dpad-btn" id="leftBtn">‚¨ÖÔ∏è</div>
                <div class="dpad-btn empty"></div>
                <div class="dpad-btn" id="rightBtn">‚û°Ô∏è</div>
            </div>
            <div id="jumpBtn">JUMP</div>
        </div>
    </div>

<script>
// Get elements
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const overlay = document.getElementById('overlay');
const overlayTitle = document.getElementById('overlayTitle');
const overlayText = document.getElementById('overlayText');
const overlayInfo = document.getElementById('overlayInfo');
const overlayBtn = document.getElementById('overlayBtn');

// Game state
let gameState = 'menu';
let score = 0;
let level = 1;
let poopsCompleted = 0;
let requiredPoops = 2;

// Murry
const murry = {
    x: 100, y: 350,
    width: 40, height: 60,
    vx: 0, vy: 0,
    speed: 5,
    jumpPower: -13,
    onGround: false,
    facing: 1,
    belly: 0,
    hunger: 100,
    state: 'idle',
    animFrame: 0,
    poopTimer: 0
};

// Physics
const GRAVITY = 0.5;
const FRICTION = 0.85;

// Platforms
let platforms = [];
let toilet = {};
let sandwiches = [];
let particles = [];

// Input
const keys = {};

// Level data
const levels = [
    {
        platforms: [
            {x: 0, y: 460, w: 800, h: 40},
            {x: 100, y: 380, w: 120, h: 15},
            {x: 300, y: 320, w: 120, h: 15},
            {x: 500, y: 380, w: 120, h: 15},
            {x: 200, y: 240, w: 100, h: 15},
            {x: 450, y: 200, w: 100, h: 15},
        ],
        toilet: {x: 700, y: 400, w: 50, h: 60},
        sandwiches: 5,
        poops: 2,
        hungerDecay: 0.03
    },
    {
        platforms: [
            {x: 0, y: 460, w: 800, h: 40},
            {x: 50, y: 380, w: 100, h: 15},
            {x: 200, y: 320, w: 100, h: 15},
            {x: 350, y: 260, w: 100, h: 15},
            {x: 500, y: 320, w: 100, h: 15},
            {x: 650, y: 380, w: 100, h: 15},
            {x: 300, y: 180, w: 120, h: 15},
        ],
        toilet: {x: 50, y: 400, w: 50, h: 60},
        sandwiches: 7,
        poops: 3,
        hungerDecay: 0.05
    },
    {
        platforms: [
            {x: 0, y: 460, w: 250, h: 40},
            {x: 300, y: 460, w: 200, h: 40},
            {x: 550, y: 460, w: 250, h: 40},
            {x: 100, y: 380, w: 80, h: 15},
            {x: 250, y: 320, w: 80, h: 15},
            {x: 400, y: 260, w: 80, h: 15},
            {x: 550, y: 320, w: 80, h: 15},
            {x: 700, y: 380, w: 80, h: 15},
            {x: 150, y: 200, w: 100, h: 15},
            {x: 550, y: 180, w: 100, h: 15},
        ],
        toilet: {x: 375, y: 400, w: 50, h: 60},
        sandwiches: 10,
        poops: 4,
        hungerDecay: 0.06
    }
];

let currentLevel = null;

// Initialize level
function loadLevel(num) {
    level = num;
    if (num > levels.length) {
        showOverlay('üéâ YOU WIN! üéâ', 'Murry conquered all levels!', 'Final Score: ' + score, 'PLAY AGAIN');
        gameState = 'gameover';
        level = 1;
        return;
    }

    currentLevel = levels[num - 1];
    platforms = currentLevel.platforms.map(p => ({...p}));
    toilet = {...currentLevel.toilet};
    requiredPoops = currentLevel.poops;
    poopsCompleted = 0;

    murry.x = 100;
    murry.y = 350;
    murry.vx = 0;
    murry.vy = 0;
    murry.belly = 0;
    murry.hunger = 100;
    murry.state = 'idle';

    spawnSandwiches();
    updateHUD();
}

function spawnSandwiches() {
    sandwiches = [];
    const validPlatforms = platforms.filter(p => p.w >= 80);
    for (let i = 0; i < currentLevel.sandwiches; i++) {
        const plat = validPlatforms[Math.floor(Math.random() * validPlatforms.length)];
        sandwiches.push({
            x: plat.x + 20 + Math.random() * (plat.w - 60),
            y: plat.y - 30,
            w: 35, h: 28,
            collected: false,
            bob: Math.random() * Math.PI * 2
        });
    }
}

function createParticles(x, y, color, count) {
    for (let i = 0; i < count; i++) {
        particles.push({
            x, y,
            vx: (Math.random() - 0.5) * 8,
            vy: (Math.random() - 0.5) * 8 - 3,
            life: 1,
            color,
            size: 3 + Math.random() * 4
        });
    }
}

// Keyboard input
document.addEventListener('keydown', e => {
    keys[e.code] = true;
    if (e.code === 'Space' || e.code === 'ArrowUp' || e.code === 'ArrowDown') {
        e.preventDefault();
    }
});
document.addEventListener('keyup', e => { keys[e.code] = false; });

// Mobile touch controls
function setupMobileControls() {
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');
    const upBtn = document.getElementById('upBtn');
    const jumpBtn = document.getElementById('jumpBtn');

    function addTouchEvents(element, keyCode) {
        element.addEventListener('touchstart', (e) => {
            e.preventDefault();
            keys[keyCode] = true;
            element.classList.add('active');
        }, { passive: false });

        element.addEventListener('touchend', (e) => {
            e.preventDefault();
            keys[keyCode] = false;
            element.classList.remove('active');
        }, { passive: false });

        element.addEventListener('touchcancel', (e) => {
            keys[keyCode] = false;
            element.classList.remove('active');
        });
    }

    addTouchEvents(leftBtn, 'ArrowLeft');
    addTouchEvents(rightBtn, 'ArrowRight');
    addTouchEvents(upBtn, 'ArrowUp');
    addTouchEvents(jumpBtn, 'Space');
}

// Prevent scrolling/zooming on mobile
document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });
document.addEventListener('gesturestart', e => e.preventDefault());
document.addEventListener('gesturechange', e => e.preventDefault());

// Overlay button
overlayBtn.addEventListener('click', handleOverlayClick);
overlayBtn.addEventListener('touchend', (e) => {
    e.preventDefault();
    handleOverlayClick();
});

function handleOverlayClick() {
    if (gameState === 'menu' || gameState === 'gameover') {
        score = 0;
        loadLevel(1);
        gameState = 'playing';
        hideOverlay();
    } else if (gameState === 'levelcomplete') {
        loadLevel(level + 1);
        if (gameState !== 'gameover') {
            gameState = 'playing';
            hideOverlay();
        }
    }
}

function showOverlay(title, text, info, btn) {
    overlayTitle.textContent = title;
    overlayText.textContent = text;
    overlayInfo.textContent = info;
    overlayBtn.textContent = btn;
    overlay.classList.remove('hidden');
}

function hideOverlay() {
    overlay.classList.add('hidden');
}

function updateHUD() {
    document.getElementById('scoreDisplay').textContent = score;
    document.getElementById('hungerMeter').style.width = murry.hunger + '%';
    document.getElementById('bellyMeter').style.width = murry.belly + '%';
    document.getElementById('poopDisplay').textContent = poopsCompleted + '/' + requiredPoops;
    document.getElementById('levelDisplay').textContent = level;
}

// Update game
function update() {
    if (gameState !== 'playing') return;

    murry.hunger -= currentLevel.hungerDecay;
    if (murry.hunger <= 0) {
        murry.hunger = 0;
        showOverlay('üòµ STARVED!', 'Murry ran out of fuel!', 'Score: ' + score, 'TRY AGAIN');
        gameState = 'gameover';
        return;
    }

    if (murry.state === 'pooping') {
        murry.poopTimer++;
        if (murry.poopTimer > 90) {
            murry.belly = 0;
            murry.state = 'idle';
            poopsCompleted++;
            createParticles(murry.x + 20, murry.y + 50, '#8B4513', 15);

            if (poopsCompleted >= requiredPoops && sandwiches.every(s => s.collected)) {
                showOverlay('‚úÖ LEVEL COMPLETE!', 'Murry is relieved!', 'Score: ' + score, 'NEXT LEVEL');
                gameState = 'levelcomplete';
            }
        }
        updateHUD();
        return;
    }

    const speedMod = murry.belly > 80 ? 0.5 : murry.belly > 50 ? 0.75 : 1;

    if (keys['ArrowLeft'] || keys['KeyA']) {
        murry.vx = -murry.speed * speedMod;
        murry.facing = -1;
        murry.state = murry.onGround ? 'running' : 'jumping';
    } else if (keys['ArrowRight'] || keys['KeyD']) {
        murry.vx = murry.speed * speedMod;
        murry.facing = 1;
        murry.state = murry.onGround ? 'running' : 'jumping';
    } else {
        murry.vx *= FRICTION;
        if (murry.onGround) murry.state = 'idle';
    }

    if ((keys['Space'] || keys['ArrowUp'] || keys['KeyW']) && murry.onGround) {
        const jumpMod = murry.belly > 70 ? 0.7 : 1;
        murry.vy = murry.jumpPower * jumpMod;
        murry.onGround = false;
        murry.state = 'jumping';
        createParticles(murry.x + 20, murry.y + 60, '#8B7355', 5);
    }

    murry.vy += GRAVITY;
    murry.x += murry.vx;
    murry.y += murry.vy;

    murry.onGround = false;
    for (const p of platforms) {
        if (murry.x + murry.width > p.x && murry.x < p.x + p.w &&
            murry.y + murry.height > p.y && murry.y + murry.height < p.y + p.h + 10 &&
            murry.vy >= 0) {
            murry.y = p.y - murry.height;
            murry.vy = 0;
            murry.onGround = true;
        }
    }

    if (murry.x < 0) murry.x = 0;
    if (murry.x + murry.width > canvas.width) murry.x = canvas.width - murry.width;

    if (murry.y > canvas.height + 50) {
        showOverlay('üíÄ FELL OFF!', 'Murry took a tumble!', 'Score: ' + score, 'TRY AGAIN');
        gameState = 'gameover';
        return;
    }

    for (const s of sandwiches) {
        if (!s.collected && murry.belly < 100 &&
            murry.x < s.x + s.w && murry.x + murry.width > s.x &&
            murry.y < s.y + s.h && murry.y + murry.height > s.y) {
            s.collected = true;
            murry.belly = Math.min(100, murry.belly + 25);
            murry.hunger = Math.min(100, murry.hunger + 25);
            score += 100;
            createParticles(s.x + 15, s.y + 10, '#FFD700', 10);
        }
    }

    if (murry.belly >= 50 &&
        murry.x < toilet.x + toilet.w && murry.x + murry.width > toilet.x &&
        murry.y < toilet.y + toilet.h && murry.y + murry.height > toilet.y) {
        murry.state = 'pooping';
        murry.poopTimer = 0;
        murry.vx = 0;
        murry.vy = 0;
    }

    if (sandwiches.every(s => s.collected) && poopsCompleted < requiredPoops) {
        spawnSandwiches();
    }

    for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.2;
        p.life -= 0.02;
        if (p.life <= 0) particles.splice(i, 1);
    }

    murry.animFrame++;
    updateHUD();
}

// Draw functions
function drawBackground() {
    const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    grad.addColorStop(0, '#4A90D9');
    grad.addColorStop(1, '#87CEEB');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = '#FFD700';
    ctx.beginPath();
    ctx.arc(700, 70, 40, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = 'rgba(255,255,255,0.8)';
    [[100, 60], [300, 40], [550, 70]].forEach(([x, y]) => {
        ctx.beginPath();
        ctx.arc(x, y, 25, 0, Math.PI * 2);
        ctx.arc(x + 30, y - 10, 20, 0, Math.PI * 2);
        ctx.arc(x + 55, y, 25, 0, Math.PI * 2);
        ctx.fill();
    });
}

function drawPlatforms() {
    for (const p of platforms) {
        const grad = ctx.createLinearGradient(p.x, p.y, p.x, p.y + p.h);
        if (p.h >= 30) {
            grad.addColorStop(0, '#32CD32');
            grad.addColorStop(1, '#228B22');
        } else {
            grad.addColorStop(0, '#A0522D');
            grad.addColorStop(1, '#8B4513');
        }
        ctx.fillStyle = grad;
        ctx.fillRect(p.x, p.y, p.w, p.h);
    }
}

function drawToilet() {
    const t = toilet;

    if (murry.belly >= 50) {
        ctx.shadowColor = '#00FF00';
        ctx.shadowBlur = 15 + Math.sin(Date.now() / 150) * 8;
    }

    ctx.fillStyle = '#FFFFFF';
    ctx.beginPath();
    ctx.ellipse(t.x + 25, t.y + 45, 20, 12, 0, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = '#F0F0F0';
    ctx.fillRect(t.x + 8, t.y, 34, 25);

    ctx.fillStyle = '#87CEEB';
    ctx.beginPath();
    ctx.ellipse(t.x + 25, t.y + 45, 12, 7, 0, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = '#C0C0C0';
    ctx.fillRect(t.x + 38, t.y + 8, 8, 4);

    ctx.shadowBlur = 0;

    ctx.fillStyle = '#228B22';
    ctx.font = 'bold 10px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('üöΩ RELIEF', t.x + 25, t.y - 5);
}

function drawSandwich(s) {
    if (s.collected) return;

    const bobY = Math.sin(Date.now() / 300 + s.bob) * 3;
    const x = s.x, y = s.y + bobY;

    ctx.shadowColor = '#FFD700';
    ctx.shadowBlur = 12;

    ctx.fillStyle = '#DEB887';
    ctx.beginPath();
    ctx.ellipse(x + 17, y + 22, 16, 6, 0, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = '#32CD32';
    for (let i = 0; i < 5; i++) {
        ctx.beginPath();
        ctx.arc(x + 5 + i * 6, y + 16, 4, 0, Math.PI * 2);
        ctx.fill();
    }

    ctx.fillStyle = '#DAA520';
    ctx.beginPath();
    ctx.ellipse(x + 17, y + 12, 14, 5, 0, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = '#CD853F';
    for (let i = 0; i < 4; i++) {
        ctx.beginPath();
        ctx.arc(x + 7 + i * 7, y + 12, 2, 0, Math.PI * 2);
        ctx.fill();
    }

    ctx.shadowBlur = 0;
    ctx.fillStyle = '#8B0000';
    ctx.font = 'bold 7px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('CHICKEN', x + 17, y + 14);

    ctx.shadowColor = '#FFD700';
    ctx.shadowBlur = 12;
    ctx.fillStyle = '#DEB887';
    ctx.beginPath();
    ctx.ellipse(x + 17, y + 5, 15, 8, 0, Math.PI, 2 * Math.PI);
    ctx.fill();
    ctx.fillRect(x + 2, y + 4, 30, 4);

    ctx.fillStyle = '#FFFACD';
    ctx.beginPath();
    ctx.ellipse(x + 12, y + 2, 2, 1, 0.3, 0, Math.PI * 2);
    ctx.ellipse(x + 22, y + 1, 2, 1, -0.2, 0, Math.PI * 2);
    ctx.fill();

    ctx.shadowBlur = 0;
}

function drawMurry() {
    const x = murry.x, y = murry.y;
    const bellySize = (murry.belly / 100) * 12;

    ctx.save();

    if (murry.facing === -1) {
        ctx.translate(x + murry.width / 2, 0);
        ctx.scale(-1, 1);
        ctx.translate(-(x + murry.width / 2), 0);
    }

    let legOffset = 0;
    if (murry.state === 'running') {
        legOffset = Math.sin(murry.animFrame * 0.4) * 5;
    }

    ctx.fillStyle = 'rgba(0,0,0,0.3)';
    ctx.beginPath();
    ctx.ellipse(x + 20, y + 62, 15 + bellySize/2, 5, 0, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = '#FFFFFF';
    ctx.fillRect(x + 6, y + 52 - legOffset/2, 10, 8);
    ctx.fillRect(x + 24, y + 52 + legOffset/2, 10, 8);
    ctx.fillStyle = '#8B4513';
    ctx.fillRect(x + 6, y + 58 - legOffset/2, 10, 3);
    ctx.fillRect(x + 24, y + 58 + legOffset/2, 10, 3);

    ctx.fillStyle = '#FDBF6F';
    ctx.fillRect(x + 8, y + 38 - legOffset, 7, 15);
    ctx.fillRect(x + 25, y + 38 + legOffset, 7, 15);

    ctx.fillStyle = '#C3B091';
    ctx.fillRect(x + 5, y + 30, 30, 12);

    ctx.fillStyle = '#FDBF6F';
    ctx.beginPath();
    ctx.ellipse(x + 20, y + 24, 14 + bellySize, 10 + bellySize * 0.7, 0, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = '#FF69B4';
    ctx.beginPath();
    ctx.ellipse(x + 20, y + 20, 15 + bellySize, 12 + bellySize * 0.5, 0, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = '#FF1493';
    ctx.beginPath();
    ctx.moveTo(x + 15, y + 8);
    ctx.lineTo(x + 20, y + 13);
    ctx.lineTo(x + 25, y + 8);
    ctx.fill();

    const flowers = [
        {dx: 8, dy: 18, c: '#FFFF00'},
        {dx: 28, dy: 15, c: '#00FF00'},
        {dx: 18, dy: 25, c: '#87CEEB'},
        {dx: 12, dy: 28, c: '#FFA500'},
    ];
    flowers.forEach(f => {
        ctx.fillStyle = f.c;
        ctx.beginPath();
        ctx.arc(x + f.dx, y + f.dy + bellySize * 0.3, 3, 0, Math.PI * 2);
        ctx.fill();
    });

    ctx.fillStyle = '#FDBF6F';
    ctx.fillRect(x, y + 12, 5, 14);
    ctx.fillRect(x + 35, y + 12, 5, 14);

    ctx.fillStyle = '#FDBF6F';
    ctx.beginPath();
    ctx.arc(x + 20, y, 12, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = '#8B4513';
    ctx.beginPath();
    ctx.arc(x + 20, y - 4, 10, Math.PI, 2 * Math.PI);
    ctx.fill();

    ctx.fillStyle = '#000';
    ctx.beginPath();
    ctx.arc(x + 16, y - 2, 2, 0, Math.PI * 2);
    ctx.arc(x + 24, y - 2, 2, 0, Math.PI * 2);
    ctx.fill();

    ctx.strokeStyle = '#000';
    ctx.lineWidth = 2;
    ctx.beginPath();
    if (murry.state === 'pooping') {
        ctx.arc(x + 20, y + 4, 4, 0, Math.PI);
        ctx.stroke();
        ctx.fillStyle = '#87CEEB';
        ctx.beginPath();
        ctx.arc(x + 28, y - 6, 3, 0, Math.PI * 2);
        ctx.fill();
    } else if (murry.belly > 80) {
        ctx.moveTo(x + 16, y + 4);
        ctx.lineTo(x + 24, y + 4);
        ctx.stroke();
    } else if (murry.hunger < 30) {
        ctx.arc(x + 20, y + 6, 4, 1.2 * Math.PI, 1.8 * Math.PI);
        ctx.stroke();
    } else {
        ctx.arc(x + 20, y + 2, 4, 0.1 * Math.PI, 0.9 * Math.PI);
        ctx.stroke();
    }

    if (murry.belly > 60) {
        ctx.font = 'bold 10px Arial';
        ctx.fillStyle = murry.belly > 80 ? '#FF0000' : '#FF8800';
        ctx.textAlign = 'center';
        ctx.fillText(murry.belly > 80 ? 'üöΩ!!!' : 'üöΩ?', x + 20, y - 18);
    }

    ctx.restore();
}

function drawParticles() {
    for (const p of particles) {
        ctx.globalAlpha = p.life;
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
    }
    ctx.globalAlpha = 1;
}

function draw() {
    drawBackground();
    drawPlatforms();
    drawToilet();
    for (const s of sandwiches) drawSandwich(s);
    drawMurry();
    drawParticles();
}

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

// Initialize
setupMobileControls();
showOverlay('üçó MURRY FUEL üçó', 'Help Murry chase chicken sandwiches!',
    'Eat üçó ‚Üí Belly full ‚Üí Find üöΩ ‚Üí Poop ‚Üí Repeat!', 'START GAME');
gameLoop();
</script>
</body>
</html>
